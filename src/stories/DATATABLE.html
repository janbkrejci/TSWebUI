<div class="sl-theme-{{theme}} main-container">
    <script>
        // Utility functions for page number input
        let pageNumberClick = (event) => {
            event.target.select();
            event.preventDefault();
        };
        
        let pageNumberKeyDown = (event) => {
            if (!/[0-9]/.test(event.key) && event.key !== 'Backspace' && event.key !== 'Delete' && event.key !== 'ArrowLeft' && event.key !== 'ArrowRight') {
                event.preventDefault();
            }
            if (event.key === 'Enter') {
                event.target.blur();
            }
        };
        
        let pageNumberBlur = (event) => {
            const value = parseInt(event.target.value);
            const totalPages = getTotalPages();
            if (isNaN(value) || value < 1) {
                event.target.value = 1;
            } else if (value > totalPages) {
                event.target.value = totalPages;
            } else if (value !== currentPage) {
                goToPage(value);
            }
        };

        // Pagination state
        let currentPage = 1;
        let itemsPerPage = 5;
        const availablePageSizes = [5, 10, 20, 50, 100];

        // Table data - expanded dataset for pagination testing
        const tableData = [
            {
                id: 1,
                name: "Leanne Graham",
                username: "Bret",
                email: "leanne@example.com",
                city: "London",
                phone: "555-1234",
                website: "www.leannegraham.com",
                company: "Example Corp"
            },
            {
                id: 2,
                name: "Ervin Howell",
                username: "Antonette",
                email: "ervin@example.com",
                city: "Paris",
                phone: "555-5678",
                website: "www.ervinhowell.com",
                company: "Howell LLC"
            },
            {
                id: 3,
                name: "Clementine Bauch",
                username: "Samantha",
                email: "clementine@example.com",
                city: "Berlin",
                phone: "555-8765",
                website: "www.clementine.com",
                company: "Bauch Group"
            },
            {
                id: 4,
                name: "Patricia Lebsack",
                username: "Karianne",
                email: "patricia@example.com",
                city: "Madrid",
                phone: "555-4321",
                website: "www.patricia.com",
                company: "Lebsack Ltd"
            },
            {
                id: 5,
                name: "Chelsey Dietrich",
                username: "Kameron",
                email: "chelsey@example.com",
                city: "Rome",
                phone: "555-2468",
                website: "www.chelsey.com",
                company: "Dietrich Inc"
            },
            {
                id: 6,
                name: "Mrs. Dennis Schulist",
                username: "Leopoldo_Corkery",
                email: "dennis@example.com",
                city: "Vienna",
                phone: "555-1357",
                website: "www.dennis.com",
                company: "Schulist Group"
            },
            {
                id: 7,
                name: "Kurtis Weissnat",
                username: "Elwyn.Skiles",
                email: "kurtis@example.com",
                city: "Prague",
                phone: "555-9753",
                website: "www.kurtis.com",
                company: "Weissnat LLC"
            },
            {
                id: 8,
                name: "Nicholas Runolfsdottir",
                username: "Maxime_Nienow",
                email: "nicholas@example.com",
                city: "Brno",
                phone: "555-8642",
                website: "www.nicholas.com",
                company: "Runolfsdottir Ltd"
            },
            {
                id: 9,
                name: "Glenna Reichert",
                username: "Delphine",
                email: "glenna@example.com",
                city: "Ostrava",
                phone: "555-7531",
                website: "www.glenna.com",
                company: "Reichert Group"
            },
            {
                id: 10,
                name: "Clementina DuBuque",
                username: "Moriah.Stanton",
                email: "clementina@example.com",
                city: "Plze≈à",
                phone: "555-1597",
                website: "www.clementina.com",
                company: "DuBuque Inc"
            },
            {
                id: 11,
                name: "John Smith",
                username: "johnny_s",
                email: "john@example.com",
                city: "New York",
                phone: "555-2001",
                website: "www.johnsmith.com",
                company: "Smith Industries"
            },
            {
                id: 12,
                name: "Sarah Johnson",
                username: "sarah_j",
                email: "sarah@example.com",
                city: "Los Angeles",
                phone: "555-2002",
                website: "www.sarahjohnson.com",
                company: "Johnson Corp"
            },
            {
                id: 13,
                name: "Michael Brown",
                username: "mike_b",
                email: "michael@example.com",
                city: "Chicago",
                phone: "555-2003",
                website: "www.mikebrown.com",
                company: "Brown LLC"
            },
            {
                id: 14,
                name: "Emily Davis",
                username: "emily_d",
                email: "emily@example.com",
                city: "Houston",
                phone: "555-2004",
                website: "www.emilydavis.com",
                company: "Davis Group"
            },
            {
                id: 15,
                name: "David Wilson",
                username: "david_w",
                email: "david@example.com",
                city: "Phoenix",
                phone: "555-2005",
                website: "www.davidwilson.com",
                company: "Wilson Inc"
            },
            {
                id: 16,
                name: "Lisa Miller",
                username: "lisa_m",
                email: "lisa@example.com",
                city: "Philadelphia",
                phone: "555-2006",
                website: "www.lisamiller.com",
                company: "Miller Ltd"
            },
            {
                id: 17,
                name: "Robert Taylor",
                username: "rob_t",
                email: "robert@example.com",
                city: "San Antonio",
                phone: "555-2007",
                website: "www.robtaylor.com",
                company: "Taylor Enterprises"
            },
            {
                id: 18,
                name: "Jennifer Anderson",
                username: "jen_a",
                email: "jennifer@example.com",
                city: "San Diego",
                phone: "555-2008",
                website: "www.jenanderson.com",
                company: "Anderson Co"
            },
            {
                id: 19,
                name: "Christopher Moore",
                username: "chris_m",
                email: "christopher@example.com",
                city: "Dallas",
                phone: "555-2009",
                website: "www.chrismoore.com",
                company: "Moore Group"
            },
            {
                id: 20,
                name: "Amanda Thomas",
                username: "amanda_t",
                email: "amanda@example.com",
                city: "San Jose",
                phone: "555-2010",
                website: "www.amandathomas.com",
                company: "Thomas Inc"
            },
            {
                id: 21,
                name: "James White",
                username: "james_w",
                email: "james@example.com",
                city: "Austin",
                phone: "555-2011",
                website: "www.jameswhite.com",
                company: "White Corp"
            },
            {
                id: 22,
                name: "Jessica Harris",
                username: "jess_h",
                email: "jessica@example.com",
                city: "Jacksonville",
                phone: "555-2012",
                website: "www.jessharris.com",
                company: "Harris LLC"
            },
            {
                id: 23,
                name: "Matthew Martin",
                username: "matt_m",
                email: "matthew@example.com",
                city: "Fort Worth",
                phone: "555-2013",
                website: "www.mattmartin.com",
                company: "Martin Group"
            },
            {
                id: 24,
                name: "Ashley Clark",
                username: "ash_c",
                email: "ashley@example.com",
                city: "Columbus",
                phone: "555-2014",
                website: "www.ashleyclark.com",
                company: "Clark Industries"
            },
            {
                id: 25,
                name: "Daniel Rodriguez",
                username: "dan_r",
                email: "daniel@example.com",
                city: "Charlotte",
                phone: "555-2015",
                website: "www.danrodriguez.com",
                company: "Rodriguez Inc"
            }
        ];

        // Row menu actions configuration
        const menuActions = [
            { actionName: 'edit', label: 'Edit' },
            { actionName: 'duplicate', label: 'Duplicate' },
            { actionName: 'delete', label: 'Delete' },
            { actionName: 'view_details', label: 'View Details' },
            { actionName: 'export', label: 'Export Row' }
        ];

        // Function to handle row menu item selection
        function rowMenuItemSelected(menuAction, rowData) {
            console.log('Selected action:', menuAction, 'for row:', rowData);
        }

        // Column definitions for dynamic table creation
        const columnDefinitions = [
            { 
                key: 'id', 
                title: 'ID', 
                sortable: false, 
                sortDirection: 'none',
                className: 'id-column',
                filterable: true,
                filterPlaceholder: 'Filter ID',
                visible: false,
                align: 'right'
            },
            { 
                key: 'name', 
                title: 'Name', 
                sortable: true, 
                sortDirection: 'asc',
                className: '',
                filterable: true,
                filterPlaceholder: 'Filter Name',
                visible: true,
                align: 'left'
            },
            { 
                key: 'username', 
                title: 'Username', 
                sortable: true, 
                sortDirection: 'desc',
                className: '',
                filterable: true,
                filterPlaceholder: 'Filter Username',
                visible: false,
                align: 'left'
            },
            { 
                key: 'email', 
                title: 'Email', 
                sortable: false, 
                sortDirection: 'none',
                className: '',
                filterable: true,
                filterPlaceholder: 'Filter Email',
                visible: false,
                align: 'left'
            },
            { 
                key: 'city', 
                title: 'City', 
                sortable: false, 
                sortDirection: 'none',
                className: '',
                filterable: true,
                filterPlaceholder: 'Filter City',
                visible: false,
                align: 'left'
            },
            { 
                key: 'phone', 
                title: 'Phone', 
                sortable: false, 
                sortDirection: 'none',
                className: '',
                filterable: true,
                filterPlaceholder: 'Filter Phone',
                visible: false,
                align: 'center'
            },
            { 
                key: 'website', 
                title: 'Website', 
                sortable: false, 
                sortDirection: 'none',
                className: '',
                filterable: true,
                filterPlaceholder: 'Filter Website',
                visible: false,
                align: 'left'
            },
            { 
                key: 'company', 
                title: 'Company', 
                sortable: false, 
                sortDirection: 'none',
                className: '',
                filterable: true,
                filterPlaceholder: 'Filter Company',
                visible: false,
                align: 'left'
            }
        ];

        // Column visibility configuration
        const preselectedColumns = ['name', 'email'];
        const unhideableColumns = ['name', 'email'];

        // Function to get visible columns based on column definitions
        function getVisibleColumns() {
            return columnDefinitions.filter(col => col.visible);
        }

        // Pagination functions
        function getTotalPages() {
            return Math.ceil(tableData.length / itemsPerPage);
        }

        function getCurrentPageData() {
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            return tableData.slice(startIndex, endIndex);
        }

        function updatePaginationUI() {
            const totalPages = getTotalPages();
            
            // Update page number input
            const pageInput = document.getElementById('page-number');
            if (pageInput) {
                pageInput.value = currentPage;
                pageInput.max = totalPages;
            }

            // Update page info
            const pageInfo = document.getElementById('page-info');
            if (pageInfo) {
                pageInfo.querySelector('sl-input').nextSibling.textContent = ` / ${totalPages}`;
            }

            // Update item count
            const itemCount = document.getElementById('item-count');
            if (itemCount) {
                const startItem = (currentPage - 1) * itemsPerPage + 1;
                const endItem = Math.min(currentPage * itemsPerPage, tableData.length);
                itemCount.textContent = `Zobrazeno ${startItem}-${endItem} z ${tableData.length}`;
            }

            // Update items per page dropdown
            const itemsPerPageButton = document.querySelector('.items-per-page sl-button');
            if (itemsPerPageButton) {
                itemsPerPageButton.textContent = '';
                itemsPerPageButton.innerHTML = `${itemsPerPage}<sl-icon name="chevron-down" class="chevron-icon"></sl-icon>`;
            }

            // Update navigation buttons
            const prevButtons = document.querySelectorAll('.pager sl-button-group:first-child sl-button');
            const nextButtons = document.querySelectorAll('.pager sl-button-group:last-child sl-button');
            
            // First page and previous page buttons
            prevButtons.forEach(btn => {
                btn.disabled = currentPage <= 1;
            });
            
            // Next page and last page buttons
            nextButtons.forEach(btn => {
                btn.disabled = currentPage >= totalPages;
            });
        }

        function goToPage(page) {
            const totalPages = getTotalPages();
            if (page >= 1 && page <= totalPages && page !== currentPage) {
                currentPage = page;
                populateTable();
                updatePaginationUI();
            }
        }

        function changeItemsPerPage(newSize) {
            itemsPerPage = newSize;
            currentPage = 1; // Reset to first page
            populateTable();
            updatePaginationUI();
        }

        // Function to select all columns (respecting unhideable columns)
        function selectAllColumns() {
            // Update column definitions
            columnDefinitions.forEach(col => {
                col.visible = true;
            });

            // Recreate menu to reflect changes
            createColumnsMenu();
            populateTable();
        }

        // Function to clear all columns (respecting unhideable columns)
        function clearAllColumns() {
            // Update column definitions (keep unhideable columns visible)
            columnDefinitions.forEach(col => {
                if (!unhideableColumns.includes(col.key)) {
                    col.visible = false;
                }
            });

            // Recreate menu to reflect changes
            createColumnsMenu();
            populateTable();
        }

        // Track dropdown interaction state
        let dropdownInteractionTime = 0;

        // Handle row clicks
        let rowClicked = (event) => {
            // Don't fire row clicked if a dropdown was recently interacted with
            const timeSinceDropdownInteraction = Date.now() - dropdownInteractionTime;
            if (timeSinceDropdownInteraction < 200) {
                return;
            }
            
            if (event.target.closest('sl-checkbox') || event.target.tagName === 'SL-CHECKBOX' ||
                event.target.closest('sl-dropdown') || event.target.closest('.menu-column')) {
                return;
            }
            let row = event.currentTarget;
            let id = row.cells[2].textContent; // Updated index due to menu column
            console.log('Row clicked with ID:', id);
        };

        // Function to create sort indicator SVG
        function createSortIndicator(sortable = false, direction = 'none') {
            if (!sortable) return '';
            
            const upColor = direction === 'asc' ? 'var(--sl-color-neutral-500)' : 'var(--sl-color-neutral-300)';
            const downColor = direction === 'desc' ? 'var(--sl-color-neutral-500)' : 'var(--sl-color-neutral-300)';
            
            return `
                <span class="sort-indicator">
                    <svg width="10" height="16" viewBox="0 0 10 16" class="sort-svg">
                        <polygon points="5,3 1,7 9,7" fill="${upColor}" />
                        <polygon points="5,13 1,9 9,9" fill="${downColor}" />
                    </svg>
                </span>
            `;
        }

        // Function to create table headers dynamically
        function createTableHeaders() {
            const table = document.getElementById('data-table');
            if (!table) return false;

            const thead = table.querySelector('thead');
            if (!thead) return false;

            // Clear existing headers
            thead.innerHTML = '';

            // Create main header row
            const headerRow = document.createElement('tr');
            
            // Add menu column
            const menuHeader = document.createElement('th');
            menuHeader.className = 'menu-column';
            menuHeader.style.width = '32px';
            headerRow.appendChild(menuHeader);

            // Add checkbox column
            const checkboxHeader = document.createElement('th');
            checkboxHeader.className = 'checkbox-column';
            headerRow.appendChild(checkboxHeader);

            // Get visible columns
            const visibleColumns = getVisibleColumns();

            // Add column headers from visible definitions
            visibleColumns.forEach((col, index) => {
                const th = document.createElement('th');
                if (col.className) {
                    th.className = col.className;
                }
                
                // Apply text alignment
                if (col.align) {
                    th.style.textAlign = col.align;
                }
                
                th.innerHTML = col.title + createSortIndicator(col.sortable, col.sortDirection);
                headerRow.appendChild(th);
            });

            thead.appendChild(headerRow);

            // Create filter row
            const filterRow = document.createElement('tr');
            filterRow.className = 'filter-row';
            
            // Add empty menu column for filter row
            const menuFilter = document.createElement('th');
            menuFilter.className = 'menu-column';
            filterRow.appendChild(menuFilter);
            
            // Add checkbox column for filter row
            const checkboxFilter = document.createElement('th');
            checkboxFilter.className = 'checkbox-column';
            checkboxFilter.innerHTML = '<sl-checkbox></sl-checkbox>';
            filterRow.appendChild(checkboxFilter);
            
            // Add event listener to block header checkbox changes after dropdown interaction
            const headerCheckbox = checkboxFilter.querySelector('sl-checkbox');
            if (headerCheckbox) {
                headerCheckbox.addEventListener('sl-change', (event) => {
                    const timeSinceDropdownInteraction = Date.now() - dropdownInteractionTime;
                    if (timeSinceDropdownInteraction < 200) {
                        event.preventDefault();
                        // Revert checkbox state
                        setTimeout(() => {
                            headerCheckbox.checked = !headerCheckbox.checked;
                        }, 10);
                    }
                });
            }

            // Add filter inputs for each visible column
            visibleColumns.forEach(col => {
                const th = document.createElement('th');
                
                // Apply text alignment to filter row
                if (col.align) {
                    th.style.textAlign = col.align;
                }
                
                if (col.filterable) {
                    th.innerHTML = `<sl-input size="small" placeholder="${col.filterPlaceholder}" autocomplete="off"></sl-input>`;
                }
                filterRow.appendChild(th);
            });

            thead.appendChild(filterRow);

            // Add escape key handlers for filter inputs
            const filterInputs = filterRow.querySelectorAll('sl-input');
            filterInputs.forEach(input => {
                input.addEventListener('keydown', (event) => {
                    if (event.key === 'Escape') {
                        event.target.value = '';
                    }
                });
            });

            return true;
        }

        // Updated populate table function
        function populateTable() {
            
            // Find table using specific ID
            const table = document.getElementById('data-table');
            if (!table) {
                return false;
            }

            // Create headers dynamically
            if (!createTableHeaders()) {
                return false;
            }
             
            const tbody = table.querySelector('tbody');
            if (!tbody) {
                 return false;
            }
             
            // Clear existing rows
            tbody.innerHTML = '';
            
            // Get visible columns
            const visibleColumns = getVisibleColumns();

            // Get current page data for pagination
            const currentPageData = getCurrentPageData();

            // Add actual data rows (paginated)
            currentPageData.forEach((row, index) => {
                const tr = document.createElement('tr');
                
                // Add menu cell with dropdown
                const menuCell = document.createElement('td');
                menuCell.className = 'menu-column';
                
                const dropdownId = `row-menu-${row.id}`;
                const menuItems = menuActions.map(action => 
                    `<sl-menu-item data-action="${action.actionName}">${action.label}</sl-menu-item>`
                ).join('');
                
                menuCell.innerHTML = `
                    <sl-dropdown id="${dropdownId}">
                        <sl-button slot="trigger" size="small" variant="text" circle>
                            <sl-icon name="three-dots-vertical"></sl-icon>
                        </sl-button>
                        <sl-menu>
                            ${menuItems}
                        </sl-menu>
                    </sl-dropdown>
                `;
                tr.appendChild(menuCell);
                
                // Add event listener for menu selection
                const dropdown = menuCell.querySelector('sl-dropdown');
                const menu = dropdown.querySelector('sl-menu');
                
                // Track dropdown interactions
                dropdown.addEventListener('sl-show', () => {
                    dropdownInteractionTime = Date.now();
                });
                
                dropdown.addEventListener('sl-hide', () => {
                    dropdownInteractionTime = Date.now();
                });
                
                // Also track clicks on the dropdown trigger button
                const triggerButton = dropdown.querySelector('[slot="trigger"]');
                if (triggerButton) {
                    triggerButton.addEventListener('mousedown', () => {
                        dropdownInteractionTime = Date.now();
                    });
                }
                
                menu.addEventListener('sl-select', (event) => {
                    const actionName = event.detail.item.getAttribute('data-action');
                    const action = menuActions.find(a => a.actionName === actionName);
                    if (action) {
                        rowMenuItemSelected(action, row);
                    }
                });
                
                // Add checkbox cell
                const checkboxCell = document.createElement('td');
                checkboxCell.innerHTML = '<sl-checkbox></sl-checkbox>';
                tr.appendChild(checkboxCell);
                
                // Add event listener to block checkbox changes after dropdown interaction
                const checkbox = checkboxCell.querySelector('sl-checkbox');
                if (checkbox) {
                    checkbox.addEventListener('sl-change', (event) => {
                        const timeSinceDropdownInteraction = Date.now() - dropdownInteractionTime;
                        if (timeSinceDropdownInteraction < 200) {
                            event.preventDefault();
                            // Revert checkbox state
                            setTimeout(() => {
                                checkbox.checked = !checkbox.checked;
                            }, 10);
                        }
                    });
                }

                // Add data cells based on visible column definitions
                visibleColumns.forEach(col => {
                    const td = document.createElement('td');
                    
                    // Apply text alignment
                    if (col.align) {
                        td.style.textAlign = col.align;
                    }
                    
                    td.textContent = row[col.key];
                    tr.appendChild(td);
                });


                
                // Add row click handler
                tr.addEventListener('click', rowClicked);

                tbody.appendChild(tr);
            });

            // Update pagination UI after populating table
            updatePaginationUI();
            
            return true;
        }

        // Function to clear the column search filter
        function clearColumnFilter() {
            const searchInput = document.querySelector('.columns-menu #column-search');
            if (searchInput) {
                searchInput.value = '';
                filterColumnMenu('');
            }
        }

        // Function to filter column menu items by hiding/showing
        function filterColumnMenu(searchTerm) {
            const columnsMenu = document.querySelector('.columns-menu');
            if (!columnsMenu) {
                return;
            }

            const menuItems = columnsMenu.querySelectorAll('sl-menu-item[role="menuitemcheckbox"]');
            const lowerSearchTerm = searchTerm.toLowerCase();
            menuItems.forEach(item => {
                const columnTitle = item.textContent.toLowerCase();
                if (columnTitle.includes(lowerSearchTerm)) {
                    item.classList.remove('column-filter-hidden');
                } else {
                    item.classList.add('column-filter-hidden');
                }
            });
        }

        // Function to create columns menu dynamically
        function createColumnsMenu() {
            const columnsMenu = document.querySelector('.columns-menu');
            if (!columnsMenu) return false;

            // Clear existing menu items
            columnsMenu.innerHTML = '';

            // Add standard menu items
            const selectAll = document.createElement('sl-menu-item');
            selectAll.textContent = 'Select All';
            selectAll.setAttribute('data-action', 'select-all');
            columnsMenu.appendChild(selectAll);

            const clearAll = document.createElement('sl-menu-item');
            clearAll.textContent = 'Clear All';
            clearAll.setAttribute('data-action', 'clear-all');
            columnsMenu.appendChild(clearAll);

            const divider = document.createElement('sl-divider');
            columnsMenu.appendChild(divider);

            const searchInput = document.createElement('sl-input');
            searchInput.autofocus = true;
            searchInput.placeholder = 'Search columns...';
            searchInput.className = 'search-input';
            searchInput.setAttribute('id', 'column-search');
            searchInput.setAttribute('autocomplete', 'off');
            columnsMenu.appendChild(searchInput);

            // Add column items from definitions
            columnDefinitions.forEach(col => {
                const menuItem = document.createElement('sl-menu-item');
                menuItem.type = 'checkbox';
                menuItem.textContent = col.title;
                menuItem.setAttribute('data-column-key', col.key);
                // Set checkbox state based on column visibility
                menuItem.checked = col.visible;
                // Mark unhideable columns as disabled
                if (unhideableColumns.includes(col.key)) {
                    menuItem.setAttribute('data-unhideable', 'true');
                    menuItem.disabled = true;
                }
                columnsMenu.appendChild(menuItem);
            });

            // Add search functionality
            const searchElement = columnsMenu.querySelector('#column-search');
            if (searchElement) {
                ['input', 'sl-input', 'keyup', 'change'].forEach(eventType => {
                    searchElement.addEventListener(eventType, (event) => {
                        const value = event.target.value || '';
                        // Small delay to ensure DOM is ready
                        setTimeout(() => filterColumnMenu(value), 10);
                    });
                });

                // Add escape key handler for column search
                searchElement.addEventListener('keydown', (event) => {
                    if (event.key === 'Escape') {
                        event.preventDefault();
                        event.stopPropagation();
                        event.stopImmediatePropagation();
                        event.target.value = '';
                        filterColumnMenu('');
                    }
                });
            } else {
                console.error('Search element not found!');
            }

            return true;
        }

        // Initialize table with retry logic
        function initializeTable() {
            // set preselected columns visibility in columns definitions
            columnDefinitions.forEach(col => {
                if (preselectedColumns.includes(col.key) || unhideableColumns.includes(col.key)) {
                    col.visible = true;
                } else  {
                    col.visible = false;
                }
            });
            // Create columns menu
            createColumnsMenu();
            
            // Populate table
            populateTable();
            
            // Add focus behavior when dropdown opens
            const columnsDropdown = document.querySelector('sl-dropdown');
            if (columnsDropdown) {
                columnsDropdown.addEventListener('sl-show', () => {
                    // Small delay to ensure the dropdown content is rendered
                    setTimeout(() => {
                        const searchInput = document.querySelector('.columns-menu #column-search');
                        if (searchInput) {
                            searchInput.focus();
                        }
                    }, 50);
                });
            }

            // Add listener to column menu sl-select event
            const columnsMenu = document.querySelector('.columns-menu');
            if (columnsMenu) {
                columnsMenu.addEventListener('sl-select', (event) => {
                    const selectedItem = event.detail.item;
                    const action = selectedItem?.getAttribute('data-action');
                    const columnKey = selectedItem?.getAttribute('data-column-key');
                    
                    // Clear the column filter whenever any menu item is selected
                    clearColumnFilter();
                    
                    // Handle select all / clear all actions
                    if (action === 'select-all') {
                        selectAllColumns();
                        return;
                    } else if (action === 'clear-all') {
                        clearAllColumns();
                        return;
                    }
                    
                    if (columnKey) {
                        // Find the column definition
                        const columnDef = columnDefinitions.find(col => col.key === columnKey);
                        
                        if (columnDef) {
                            // Skip processing if item is disabled (unhideable columns)
                            if (selectedItem.disabled) {
                                event.preventDefault();
                                return;
                            }
                            
                            // Check if an unhideable column is being unselected (backup protection)
                            if (selectedItem.hasAttribute('data-unhideable') && unhideableColumns.includes(columnKey)) {
                                // Prevent unselecting unhideable columns
                                if (!selectedItem.checked) {
                                    selectedItem.checked = true;
                                    columnDef.visible = true;
                                    event.preventDefault();
                                    return;
                                }
                            }
                            
                            // Update the column visibility in definition
                            columnDef.visible = selectedItem.checked;
                        }
                    }
                    
                    populateTable();
                });
            }

            // Add pagination event listeners
            setupPaginationListeners();
        }

        // Function to setup pagination event listeners
        function setupPaginationListeners() {
            // Items per page dropdown
            const itemsPerPageMenu = document.querySelector('.items-per-page sl-menu');
            if (itemsPerPageMenu) {
                itemsPerPageMenu.addEventListener('sl-select', (event) => {
                    const selectedValue = parseInt(event.detail.item.textContent);
                    if (availablePageSizes.includes(selectedValue)) {
                        changeItemsPerPage(selectedValue);
                    }
                });
            }

            // Page navigation buttons
            const pagerButtons = document.querySelectorAll('.pager sl-button');
            if (pagerButtons.length >= 4) {
                // First page button (index 0)
                pagerButtons[0].addEventListener('click', () => goToPage(1));
                
                // Previous page button (index 1)
                pagerButtons[1].addEventListener('click', () => goToPage(currentPage - 1));
                
                // Next page button (index 2)
                pagerButtons[2].addEventListener('click', () => goToPage(currentPage + 1));
                
                // Last page button (index 3)
                pagerButtons[3].addEventListener('click', () => goToPage(getTotalPages()));
            }

            // Page number input blur event (already has onblur in HTML, but let's enhance it)
            const pageInput = document.getElementById('page-number');
            if (pageInput) {
                pageInput.addEventListener('blur', (event) => {
                    const newPage = parseInt(event.target.value);
                    const totalPages = getTotalPages();
                    if (!isNaN(newPage) && newPage >= 1 && newPage <= totalPages && newPage !== currentPage) {
                        goToPage(newPage);
                    } else {
                        // Reset to current page if invalid or unchanged
                        event.target.value = currentPage;
                    }
                });
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            initializeTable();
        });
    </script>
    <div id="container">
        <!-- DATATABLE -->
        <!-- Toolbar -->
        <div class="toolbar">
            <div>
                <sl-button variant="success" circle>
                    <sl-icon name="plus"></sl-icon>
                </sl-button>
            </div>
            <div class="toolbar-center">
                <sl-button variant="danger">
                    <sl-icon name="trash"></sl-icon>
                </sl-button>
                <sl-button>Export to Excel</sl-button>
            </div>
            <div>
                <sl-dropdown>
                    <sl-button slot="trigger" caret>Columns</sl-button>
                    <sl-menu class="columns-menu">
                        <!-- Menu items will be created dynamically by createColumnsMenu() function -->
                    </sl-menu>
                </sl-dropdown>
            </div>
        </div>
        <div class="table-container">
            <table id="data-table">
                <thead>
                    <!-- Headers will be created dynamically by createTableHeaders() function -->
                </thead>
                <tbody>
                    <!-- Table rows will be populated dynamically by populateTable() function -->
                </tbody>
            </table>
        </div>
        <!-- FOOTER -->
        <div class="footer">
            <div id="item-count">Zobrazeno 1-5 z 25</div>
            <div class="items-per-page">
                Zobrazit
                <sl-dropdown>
                    <sl-button slot="trigger">
                        5
                        <sl-icon name="chevron-down" class="chevron-icon"></sl-icon>
                    </sl-button>

                    <sl-menu>
                        <sl-menu-item>5</sl-menu-item>
                        <sl-menu-item>10</sl-menu-item>
                        <sl-menu-item>20</sl-menu-item>
                        <sl-menu-item>50</sl-menu-item>
                        <sl-menu-item>100</sl-menu-item>
                    </sl-menu>
                </sl-dropdown>
                na str√°nku
            </div>
            <!-- PAGER -->
            <div class="pager">
                <sl-button-group>
                    <sl-button disabled>
                        <sl-icon name="chevron-bar-left"></sl-icon>
                    </sl-button>
                    <sl-button disabled>
                        <sl-icon name="chevron-left"></sl-icon>
                    </sl-button>
                </sl-button-group>
                <div id="page-info" variant="none">
                    Str√°nka
                    <sl-input id="page-number" size="small" value="1" onclick="pageNumberClick(event)"
                        onkeydown="pageNumberKeyDown(event)" onblur="pageNumberBlur(event)"></sl-input>
                    / 5
                </div>

                <sl-button-group>
                    <sl-button>
                        <sl-icon name="chevron-right"></sl-icon>
                    </sl-button>
                    <sl-button>
                        <sl-icon name="chevron-bar-right"></sl-icon>
                    </sl-button>
                </sl-button-group>
            </div>
        </div>
    </div>
</div>