<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TS-Table Test</title>
</head>
<body>
    <ts-table id="table"></ts-table>

     
    <!-- TS-Table Bundle - load as module -->
    <script type="module" src="./dist/ts-table-bundle.js"></script>
    
    <!-- Table data and initialization -->
    <script type="module">
        // References to component
        var table = null;

        // Column definitions
        const columnDefinitions = [
            { key: 'id', label: 'ID', type: 'number', visible: false, order: 0 },
            { key: 'name', label: 'Jméno', type: 'text', visible: true, order: 1, sortable: true },
            { key: 'email', label: 'Email', type: 'text', visible: true, order: 2, sortable: true },
            { key: 'turnover', label: 'Obrat', type: 'number', visible: true, order: 3, sortable: true, align: 'right' },
            { key: 'contractDate', label: 'Datum smlouvy', type: 'date', visible: true, order: 4, sortable: true },
            { key: 'approved', label: 'Schváleno', type: 'boolean', visible: true, order: 5, sortable: true }
        ];

        // Table data
        const tableData = [
            { id: 1, name: 'Jan Novák', email: 'jan.novak@email.cz', turnover: 125000.50, contractDate: '2024-01-15', approved: true },
            { id: 2, name: 'Marie Svobodová', email: 'marie.svobodova@email.cz', turnover: 98000.00, contractDate: '2024-02-20', approved: false },
            { id: 3, name: 'Petr Dvořák', email: 'petr.dvorak@email.cz', turnover: 156000.75, contractDate: '2024-01-10', approved: true },
            { id: 4, name: 'Jana Černá', email: 'jana.cerna@email.cz', turnover: 87000.25, contractDate: '2024-03-05', approved: false },
            { id: 5, name: 'Tomáš Procházka', email: 'tomas.prochazka@email.cz', turnover: 210000.00, contractDate: '2024-01-25', approved: true },
            { id: 6, name: 'Eva Nováková', email: 'eva.novakova@email.cz', turnover: 145000.50, contractDate: '2024-02-15', approved: false },
            { id: 7, name: 'Martin Svoboda', email: 'martin.svoboda@email.cz', turnover: 178000.00, contractDate: '2024-03-10', approved: false },
            { id: 8, name: 'Kateřina Dvořáková', email: 'katerina.dvorakova@email.cz', turnover: 132000.75, contractDate: '2024-01-30', approved: true },
            { id: 9, name: 'Jiří Černý', email: 'jiri.cerny@email.cz', turnover: 95000.00, contractDate: '2024-02-25', approved: false },
            { id: 10, name: 'Lenka Procházková', email: 'lenka.prochazkova@email.cz', turnover: 168000.50, contractDate: '2024-03-15', approved: false }
        ];

        // Configuration
        const singleItemActions = 'edit/Upravit,duplicate/Duplikovat,delete/Smazat,view_details/Zobrazit detaily,export/Exportovat řádek';
        const multipleItemsActions = 'delete/Smazat vybrané,export/Exportovat vybrané';
        const preselectedColumns = ['name', 'email', 'turnover', 'contractDate', 'approved'];
        const unhideableColumns = ['name', 'email'];
        const unshowableColumns = ['id'];
        const itemsPerPage = 5;
        const itemsPerPageOptions = [5, 10, 20, 50, -1];
        
        // Example: Only show approved records (predefined filter that can't be cleared)
        const predefinedFilters = { approved: 'true' };
        //const predefinedFilters = {};

        // Initialize component when DOM is ready
        function initializeComponents() {
            table = document.getElementById('table');

            // Configure table
            table.setColumnDefinitions(columnDefinitions);
            table.setPreselectedColumns(preselectedColumns);
            table.setUnhideableColumns(unhideableColumns);
            table.setUnshowableColumns(unshowableColumns);
            table.setSingleItemActions(singleItemActions);
            table.setMultipleItemsActions(multipleItemsActions);
            table.setItemsPerPage(itemsPerPage);
            table.setItemsPerPageOptions(itemsPerPageOptions);
            table.setPredefinedFilters(predefinedFilters);
            table.setData(tableData); // Set data after predefined filters
            
            setupEventListeners();
            
            // Initialize table
            table.initialize();
        }

        function setupEventListeners() {
            // Table events
            table.addEventListener('create-new-record', () => {
                console.log('Create new record');
            });

            table.addEventListener('selection-action-activated', (event) => {
                const { action, rows } = event.detail;
                console.log('Action:', action, 'for', rows.length, 'row(s):', rows);
            });
            
            table.addEventListener('row-clicked', (event) => {
                const { row, columnKey } = event.detail;
                console.log('Row clicked:', row, 'in column:', columnKey);
            });

            table.addEventListener('do-import', (event) => {
                const { importData, file } = event.detail;
                console.log('Import received:', importData.length, 'rows from file:', file.name);
                
                // Process import data - demo logic with random rejection
                let added = 0, updated = 0, rejected = 0, skipped = 0;
                const rejectedRows = [];
                const rejectedRowsData = [];
                const processedRows = [];
                
                importData.forEach(({ __index, data }) => {
                    // Randomly reject ~20% of rows for testing purposes
                    const shouldRejectRandomly = Math.random() < 0.2;
                    
                    if (shouldRejectRandomly) {
                        rejected++;
                        rejectedRows.push(__index);
                        rejectedRowsData.push(data);
                        return;
                    }
                    
                    // Check if row with same ID exists (for update vs add logic)
                    const existingRow = table.getAllRows().find(r => r.id === data.id);
                    
                    if (!data.id) {
                        rejected++;
                        rejectedRows.push(__index);
                        rejectedRowsData.push(data);
                    } else if (existingRow) {
                        table.updateExistingRow(data.id, data);
                        updated++;
                        processedRows.push({ ...data, __importAction: 'updated' });
                    } else {
                        table.addImportedRow(data);
                        added++;
                        processedRows.push({ ...data, __importAction: 'added' });
                    }
                });
                
                // Show results via the table (not table.toolbar)
                table.showImportResults({
                    added,
                    updated,
                    rejected,
                    skipped,
                    rejectedRows,
                    rejectedRowsData
                });
                
                console.log('Import completed:', processedRows);
            });
        }

        initializeComponents();
    </script>
</body>
</html>
