<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TS-Window Test</title>

  <script>
    // Apply theme based on system preference
    function applyTheme() {
      const isDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      document.documentElement.classList.toggle('sl-theme-dark', isDark);
      document.documentElement.classList.toggle('sl-theme-light', !isDark);
    }
    applyTheme();
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', applyTheme);
  </script>

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html,
    body {
      height: 100%;
      margin: 0;
      padding: 0;
      font-family: var(--sl-font-sans);
    }

    body {
      background: var(--sl-color-neutral-50);
      color: var(--sl-color-neutral-900);
      transition: background-color 0.3s ease, color 0.3s ease;
    }
  </style>

  <!-- Shoelace CSS and Components -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.20.1/cdn/themes/light.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.20.1/cdn/themes/dark.css" />
  <script type="module"
    src="https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.20.1/cdn/shoelace-autoloader.js"></script>

  <script src="./dist/ts-window-bundle.js" type="module"></script>
  <script src="./dist/ts-form-bundle.js" type="module"></script>
</head>

<body>
  <button id="new-window-btn" style="position:fixed;top:12px;left:12px;z-index:0;">Nové okno</button>
  <ts-window label="První okno">
    <div style="width: 800px;height: 500px;background-color: antiquewhite;">TEST</div>
  </ts-window>
  <ts-window label="Druhé oknooooooooooooooooooooooo"></ts-window>
  <ts-window label="Třetí okno">
    <div <h3>Test Controls (First Window)</h3>
      <button id="test-min">Minimize</button>
      <button id="test-max">Maximize</button>
      <button id="test-restore">Restore</button>
      <button id="test-front">Bring to Front</button>
      <button id="test-back">Send to Back</button>
      <button id="test-move">Move to 50,50</button>
      <button id="test-resize">Resize to 600x400</button>
      <button id="test-close">Close</button>
    </div>
  </ts-window>

  <!-- Jednoduché okno -->
  <ts-window label="Moje Okno">
    <p style="width: 200px; height: 100px; padding: 1rem;">Zde je nějaký obsah okna.</p>
  </ts-window>

  <!-- Okno s nastavenou pozicí a velikostí -->
  <ts-window label="Aplikace" top="50" left="50" width="600" height="400">
    <div style="background: antiquewhite;padding: 20px; width: 340px; height: 150px; box-sizing: border-box;">
      <h2>Nadpis</h2>
      <button>Klikni mě</button>
    </div>
  </ts-window>

  <script>
    const win = document.querySelector('ts-window');

    document.getElementById('test-min').onclick = () => win.minimize();
    document.getElementById('test-max').onclick = () => win.maximize();
    document.getElementById('test-restore').onclick = () => win.restore();
    document.getElementById('test-front').onclick = () => win.bringToFront();
    document.getElementById('test-back').onclick = () => win.sendToBack();

    document.getElementById('test-move').onclick = () => {
      win.setAttribute('top', '50');
      win.setAttribute('left', '50');
    };

    document.getElementById('test-resize').onclick = () => {
      win.setAttribute('width', '600');
      win.setAttribute('height', '400');
    };

    document.getElementById('test-close').onclick = () => {
      win.close();
    };

    document.getElementById('new-window-btn').onclick = function () {
      const win = document.createElement('ts-window');
      win.setAttribute('label', 'Příhlášení');
      win.setAttribute('width', '400'); // Set explicit width to ensure consistency
      win.setAttribute('height', '300'); // Set reasonable default height
      document.body.appendChild(win);

      const form = document.createElement('ts-form');
      // Fix 1: Prevent 100vh expansion
      form.style.height = 'auto';
      // Note: ts-form typically expects to fill a container, but ts-window handles content scroll.
      // If ts-form has 100vh style in shadow DOM, we might need to override it if exposed,
      // or rely on container constraints.
      // The ts-form implementation has `ts-form { height: 100vh; }` in its shadow DOM style.
      // We cannot easily override shadow DOM styles from outside unless we use a theme variable or ::part if available.
      // However, looking at ts-form.js: `ts-form { ... height: 100vh; ... }` is defined in a style block appended to the element itself (not shadow root for the main style, but ensureStructure adds specific styles).
      // Wait, ts-form extends HTMLElement and does `this.ensureStructure()` which appends `style` to `this`.
      // It does NOT use shadow DOM for the main structure styles in `ensureStructure`.
      // It does: `this.appendChild(style)`.
      // So these styles are in the light DOM but scoped via selectors? No, `ts-form { ... }` matches the element.
      // But since it's inside a style tag *inside* the element, it acts like a scoped style if it was shadow DOM, but it's not?
      // Actually `ts-form` does NOT use `attachShadow`. It just appends children.
      // So the style block `ts-form { ... }` is global if not scoped!
      // Wait, `ts-window` uses shadow DOM. `ts-form` according to lines 5-462 does NOT handle shadow DOM in `constructor` or `connectedCallback` except `ensureStructure` creating elements.
      // Line 132: `ts-form { ... height: 100vh; ... }` inside a style tag appended to `this`.
      // If the custom element does NOT have a shadow root, this `<style>` element applies styles GLOBALLY to the document (or nearest shadow root if inside one).
      // Since `ts-window` has a shadow root (`this.attachShadow({ mode: 'open' })`), and we are appending `ts-form` to `win` (which puts it in light DOM of `ts-window`? No, `win.appendChild(form)` puts it in light DOM/content slot of `ts-window`).
      // So `ts-form` is in the light DOM of the page.
      // So `ts-form { height: 100vh; }` in that style tag applies to ALL `ts-form` elements on the page (and effectively sets them all to 100vh).
      // To fix this particular instance, we can override it with inline style closer to the element, i.e., `style="height: auto"`.
      // AND we need to make sure `fitToContent` works.

      // Let's try forcing height: auto via inline style, which has higher specificity than the tag selector in the style block.
      form.style.height = 'auto';
      form.style.display = 'block'; // Ensure block display

      const fields = {
        loginInfo: { type: 'infobox', variant: 'neutral', icon: 'box-arrow-in-right', content: 'Zadejte uživatelské jméno a heslo' },
        username: {
          type: 'text',
          label: 'Uživatel',
          required: true,
          autofocus: true,
          enterAction: 'focus:password',
          escapeAction: 'click:cancel'
        },
        password: {
          type: 'password',
          label: 'Heslo',
          required: true,
          enterAction: 'submit',
          escapeAction: 'click:cancel'
        }
      };
      const layout = {
        rows: [
          [{ field: 'loginInfo', width: '1fr' }],
          [{ field: 'username', width: '1fr' }], // Ensure full width
          [{ field: 'password', width: '1fr' }]  // Ensure full width
        ]
      };
      const buttons = [
        { action: 'cancel', label: 'Zrušit', variant: 'text', position: 'left' },
        { action: 'login', label: 'Přihlásit se', variant: 'primary', position: 'right' }
      ];

      form.setAttribute('fields', JSON.stringify(fields));
      form.setAttribute('layout', JSON.stringify(layout));
      form.setAttribute('buttons', JSON.stringify(buttons));

      win.appendChild(form);

      // Initialize form
      customElements.whenDefined('ts-form').then(() => {
        form.run();
        // Adjust window size after form renders
        setTimeout(() => {
          // We do NOT want fitToContent here if we want a standard dialog size or if fitToContent is buggy.
          // However, if we want "minimal necessary space" per user request: "místo aby se omezil na minimální potřebný prostor"
          // We SHOULD use fitToContent but ensure ts-form doesn't inflate it.
          // With height: auto on form, fitToContent should work better.
          // Also, we need to ensure the form container doesn't have opacity 0 initially if fitToContent relies on dimensions.
          // ts-form fades in.

          win.fitToContent(false);
          win.centerOnScreen();
          win.bringToFront();
        }, 100);
      });

      form.addEventListener('form-submit', (e) => {
        console.log('Login attempt:', e.detail);
        alert('Login submitted: ' + JSON.stringify(e.detail.formData));
        win.close();
      });

      form.addEventListener('button-click', (e) => {
        if (e.detail.action === 'cancel') {
          win.close();
        }
      });
    };          </script>
</body>

</html>