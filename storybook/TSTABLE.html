<style>
    :not(:defined) {
        visibility: hidden;
    }

    .base-container {
        background-color: var(--sl-color-neutral-0);
        color: var(--sl-color-neutral-1000);
        font-family: var(--sl-font-sans);
        padding: 0.5em;
        display: block;
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
    }
</style>
<div class="sl-theme-{{theme}} base-container main-container">
    <ts-table id="table"></ts-table>


    <script>
        // References to component
        //poÄkat na definici web componenty ts-table

        var table = document.getElementById('table');

        // Initialize component when DOM is ready
        function initializeComponents() {

            // Configure table
            table.setColumnDefinitions(columnDefinitions);
            table.setData(tableData); // Set data after predefined filters

            setupEventListeners();

            // Initialize table
            table.run();
        }

        function setupEventListeners() {
            // Table events
            table.addEventListener('create-new-record', () => {
                console.log('Create new record');
            });

            table.addEventListener('selection-action-activated', (event) => {
                const { action, rows } = event.detail;
                console.log('Action:', action, 'for', rows.length, 'row(s):', rows);
            });

            table.addEventListener('row-clicked', (event) => {
                const { row, columnKey } = event.detail;
                console.log('Row clicked:', row, 'in column:', columnKey);
            });

            table.addEventListener('do-import', (event) => {
                const { data } = event.detail;
                console.log('Import received:', data.length);

                // Process import data - demo logic with random rejection
                let added = 0, updated = 0, rejected = 0, skipped = 0;
                const rejectedRows = [];
                const rejectedRowsData = [];
                const processedRows = [];

                importData.forEach(({ __index, data }) => {
                    // Randomly reject ~20% of rows for testing purposes
                    const shouldRejectRandomly = Math.random() < 0.2;

                    if (shouldRejectRandomly) {
                        rejected++;
                        rejectedRows.push(__index);
                        rejectedRowsData.push(data);
                        return;
                    }

                    // Check if row with same ID exists (for update vs add logic)
                    const existingRow = table.getAllRows().find(r => r.id === data.id);

                    if (!data.id) {
                        rejected++;
                        rejectedRows.push(__index);
                        rejectedRowsData.push(data);
                    } else if (existingRow) {
                        // table.updateExistingRow(data.id, data);
                        updated++;
                        processedRows.push({ ...data, __importAction: 'updated' });
                    } else {
                        // table.addImportedRow(data);
                        added++;
                        processedRows.push({ ...data, __importAction: 'added' });
                    }
                });

                // Show results via the table
                table.showImportResults({
                    added,
                    updated,
                    rejected,
                    skipped,
                    rejectedRows,
                    rejectedRowsData
                });

                console.log('Import completed:', processedRows);
            });
        }


        initializeComponents();
    </script>
</div>